{"id":"DEC-5db6","created_at":"2025-12-22T16:29:24.481Z","type":"product","problem":"Need storage that is git-native but also queryable","choice":"Dual storage: JSONL as source of truth, SQLite as derived index","rationale":"JSONL is append-only and travels with git. SQLite enables fast indexed queries and FTS5 full-text search. Index is rebuilt from JSONL when stale.","decided_by":{"role":"human"},"files":["src/core/store.ts","src/core/db.ts",".keel/decisions.jsonl"],"status":"active"}
{"id":"DEC-4baf","created_at":"2025-12-22T16:29:43.265Z","type":"product","problem":"Sequential IDs cause collisions when multiple agents create decisions concurrently","choice":"Hash-based IDs (DEC-xxxx) like Beads uses","rationale":"Content hash + timestamp + entropy creates collision-resistant IDs. No coordination needed between agents or branches.","decided_by":{"role":"human"},"files":["src/core/id.ts"],"status":"active"}
{"id":"DEC-3957","created_at":"2025-12-22T16:30:23.871Z","type":"constraint","problem":"Decisions must never be lost or silently modified","choice":"Append-only ledger: decisions are never edited, only superseded","rationale":"Append-only preserves full history. Updates are recorded as new lines. Latest state derived at read time by merging entries with same ID.","decided_by":{"role":"human"},"files":["src/core/store.ts"],"status":"active"}
{"id":"DEC-5cba","created_at":"2025-12-22T16:39:09.589Z","type":"process","problem":"Need to track both decisions (why) and work items (what)","choice":"Use Keel for decisions and Beads for issues - they complement each other","rationale":"Keel captures rationale, constraints, and learnings. Beads captures tasks, dependencies, and status. Together they provide full project context for agents.","decided_by":{"role":"human"},"status":"active"}
{"id":"DEC-36be","created_at":"2025-12-22T16:43:56.499Z","type":"product","problem":"Need to test Beads integration","choice":"Added --beads flag to decide command and queryByBead function","rationale":"Allows decisions to reference related Beads issues for bidirectional linking","decided_by":{"role":"human"},"files":["src/commands/decide.ts","src/core/db.ts","src/core/query.ts"],"beads":["keel-xr6"],"status":"active"}
{"id":"DEC-14b0","created_at":"2025-12-22T16:51:04.703Z","type":"product","problem":"Need to verify decision references are still valid","choice":"Created validate command that checks file existence","rationale":"Helps catch stale references when files are renamed or deleted","decided_by":{"role":"human"},"files":["src/commands/validate.ts","src/cli.ts"],"beads":["keel-6wa"],"status":"active"}
{"id":"DEC-7543","created_at":"2025-12-22T16:56:46.500Z","type":"product","problem":"Curate needs to summarize decisions but we assumed it needs an LLM","choice":"Keel provides data and storage, the calling agent does summarization","rationale":"The agent using Keel IS an LLM. Keel just needs getCurationCandidates, markCurated, and createSummary methods.","decided_by":{"role":"human"},"files":["src/core/curate.ts"],"beads":["keel-d4c"],"status":"active"}
{"id":"DEC-5e8f","created_at":"2025-12-24T17:44:36.961Z","type":"product","problem":"Keel only works in repos with Bun/Node runtime","choice":"Convert to Go binary like Beads","rationale":"Go binary = single executable, works in Swift/Android/any repo, matches Beads architecture","decided_by":{"role":"human"},"beads":["keel-6f7"],"status":"active"}
{"id":"DEC-1c83","created_at":"2025-12-24T17:50:16.979Z","type":"product","problem":"Agents working on an epic need to see all related decisions","choice":"Added --bead flag to keel context command","rationale":"Enables querying decisions by bead ID, so an agent can get full context for an epic with a single command","decided_by":{"role":"human"},"files":["src/commands/context.ts"],"status":"active"}
{"id":"DEC-55ff","created_at":"2025-12-24T20:52:41.952Z","type":"process","problem":"How to teach agents to use Keel together with Beads without duplicating skill content","choice":"Skills are independent - Keel skill references Beads by name, Claude discovers both by context","rationale":"Claude Code skills cannot declare dependencies. Each skill teaches its own commands, cross-references the other in content. Claude discovers relevant skills based on descriptions.","decided_by":{"role":"human"},"files":["skills/keel/SKILL.md"],"beads":["keel-siy"],"status":"active"}
{"id":"DEC-3198","created_at":"2025-12-24T21:00:48.202Z","type":"product","problem":"Need single binary that works in any repo","choice":"Ported Keel from TypeScript to Go","rationale":"Go compiles to single binary, works everywhere like Beads, uses ncruces/go-sqlite3 for pure Go SQLite","decided_by":{"role":"human"},"files":["cmd/keel/main.go","internal/types/decision.go","internal/store/store.go","internal/index/sqlite.go","internal/query/query.go"],"beads":["keel-6f7"],"status":"active"}
{"id":"DEC-2b5b","created_at":"2025-12-24T21:19:23.427705Z","type":"process","problem":"Should agents be able to initialize Keel in new repos?","choice":"No - keel init must be run by humans, not agents","rationale":"Creating decision infrastructure is a deliberate project setup decision. Matches Beads pattern where bd init is human-only.","decided_by":{"role":"human"},"files":["cmd/keel/init.go","internal/store/init.go"],"status":"active"}
{"id":"DEC-7ea7","created_at":"2025-12-25T18:47:38.829Z","type":"process","problem":"Skills need to be in .claude/skills/ for Claude Code discovery but we want them version controlled in the repo","choice":"Symlink .claude/skills/keel -> ../../skills/keel to keep source in repo while enabling discovery","rationale":"Source stays in skills/ for version control, symlink in .claude/skills/ for Claude Code auto-discovery","decided_by":{"role":"agent"},"files":["skills/keel/SKILL.md",".claude/skills/keel"],"status":"active"}
{"id":"DEC-72f8","created_at":"2025-12-25T19:00:38.300Z","type":"process","problem":"Need automated release process for distributing keel binaries","choice":"GitHub Actions workflow triggered by version tags (vX.Y.Z)","rationale":"Automated builds ensure consistent binaries across platforms, tag-based releases are git-native and simple","decided_by":{"role":"agent"},"files":[".github/workflows/release.yml","scripts/install.sh","Makefile"],"status":"active"}
{"id":"DEC-2ace","created_at":"2025-12-27T00:07:56.678913Z","type":"product","problem":"As decisions accumulate, how do users discover relevant ones? File-level decisions surface via 'keel context \u003cfile\u003e', but foundational/vision decisions aren't tied to specific files. Traditional search requires knowing what to search for.","choice":"Rely on agent-powered discovery rather than building hierarchy/tagging systems upfront. The agent queries keel naturally ('why did we build this?') and surfaces relevant decisions without users needing exact search terms.","rationale":"Agents change the discovery UX. Instead of users navigating structure, they ask questions. Over-engineering discoverability now would be premature - if it becomes a real problem at scale, solve it then. The agent IS the interface layer.","decided_by":{"role":"agent"},"status":"active"}
{"id":"DEC-0cb1","created_at":"2026-01-01T13:30:11.557535Z","type":"product","problem":"Need to visualize decision relationships and dependencies","choice":"Added keel graph command that outputs Mermaid diagrams","rationale":"Mermaid is text-based, works everywhere (GitHub, Notion, mermaid.live). No plugin needed - fits agent-is-the-interface philosophy from DEC-2ace","decided_by":{"role":"agent"},"files":["cmd/keel/graph.go","internal/query/query.go","internal/types/decision.go"],"status":"active"}
{"id":"DEC-2c53","created_at":"2026-01-01T14:06:59.014049Z","type":"product","problem":"Need to enable rollback to decision points without adding git dependency to Keel CLI","choice":"Agent-based rollback via skill documentation - agents query decision, extract commit ref from refs field, run git checkout","rationale":"Aligns with DEC-7543 philosophy: Keel provides data, agent does operations. No new CLI code needed.","decided_by":{"role":"agent"},"files":["skills/keel/SKILL.md","skills/keel/references/CLI_REFERENCE.md"],"refs":["commit:d23bf5e1f752a410b4fe922bd6e82aa8847e2d6a"],"status":"active"}
{"id":"DEC-4f97","created_at":"2026-01-01T14:20:55.001093Z","type":"process","problem":"Need to choose runtime and language for Keel CLI","choice":"Go with ncruces/go-sqlite3 for pure Go SQLite","rationale":"Go compiles to single binary, works in any repo without runtime dependencies. Supersedes original Bun+TypeScript choice.","decided_by":{"role":"human"},"files":["cmd/keel/main.go","go.mod"],"status":"active","supersedes":"DEC-1367"}
{"id":"DEC-1367","created_at":"2025-12-22T16:29:09.592Z","type":"process","problem":"Need to choose runtime and language for Keel CLI","choice":"Bun + TypeScript","rationale":"Bun provides built-in TypeScript support, fast startup for CLI, built-in SQLite, and can compile to single binary","decided_by":{"role":"human"},"files":["package.json","tsconfig.json","src/cli.ts"],"status":"superseded","superseded_by":"DEC-4f97"}
{"id":"DEC-eb18","created_at":"2026-01-01T14:24:25.15303Z","type":"product","problem":"Keel only works in repos with Bun/Node runtime","choice":"Completed: Ported to Go binary (see DEC-3198)","rationale":"Go port completed. Keel now works in any repo as a single binary.","decided_by":{"role":"human"},"status":"active","supersedes":"DEC-5e8f"}
{"id":"DEC-5e8f","created_at":"2025-12-24T17:44:36.961Z","type":"product","problem":"Keel only works in repos with Bun/Node runtime","choice":"Convert to Go binary like Beads","rationale":"Go binary = single executable, works in Swift/Android/any repo, matches Beads architecture","decided_by":{"role":"human"},"beads":["keel-6f7"],"status":"superseded","superseded_by":"DEC-eb18"}
{"id":"DEC-362c","created_at":"2026-01-01T14:25:08.221409Z","type":"process","problem":"Skills need to be discoverable by Claude Code","choice":"Use .claude-plugin/ directory structure with plugin.json and marketplace.json","rationale":"Claude Code plugin structure changed. Now uses .claude-plugin/ for plugins instead of .claude/skills/ symlinks.","decided_by":{"role":"human"},"files":[".claude-plugin/plugin.json",".claude-plugin/marketplace.json"],"status":"active","supersedes":"DEC-7ea7"}
{"id":"DEC-7ea7","created_at":"2025-12-25T18:47:38.829Z","type":"process","problem":"Skills need to be in .claude/skills/ for Claude Code discovery but we want them version controlled in the repo","choice":"Symlink .claude/skills/keel -\u003e ../../skills/keel to keep source in repo while enabling discovery","rationale":"Source stays in skills/ for version control, symlink in .claude/skills/ for Claude Code auto-discovery","decided_by":{"role":"agent"},"files":["skills/keel/SKILL.md",".claude/skills/keel"],"status":"superseded","superseded_by":"DEC-362c"}
{"id":"DEC-beac","created_at":"2026-01-01T14:32:03.29709Z","type":"product","problem":"Need to handle stale file references in decisions","choice":"Removed validate command - file refs are historical context, not errors. Agent handles renames via search and supersede.","rationale":"After Go port, many file refs point to old TypeScript paths. These are historical artifacts, not bugs. Agent uses 'keel search' to find decisions by content, not file paths.","decided_by":{"role":"agent"},"files":["src/commands/validate.ts","src/cli.ts"],"status":"active","supersedes":"DEC-14b0"}
{"id":"DEC-14b0","created_at":"2025-12-22T16:51:04.703Z","type":"product","problem":"Need to verify decision references are still valid","choice":"Created validate command that checks file existence","rationale":"Helps catch stale references when files are renamed or deleted","decided_by":{"role":"human"},"files":["src/commands/validate.ts","src/cli.ts"],"beads":["keel-6wa"],"status":"superseded","superseded_by":"DEC-beac"}
{"id":"DEC-c9b4","created_at":"2026-01-01T18:54:58.881564Z","type":"product","problem":"Need to validate that the Keel skill correctly teaches agents to respect decisions as constraints","choice":"Added evals/ directory with TypeScript harness using Claude Agent SDK, LLM-as-judge evaluation, and 5 conflict detection test cases","rationale":"Evals use Keel's own decisions as test data. Agent is given a request that conflicts with a decision; pass = agent blocks and cites the decision.","decided_by":{"role":"agent"},"files":["evals/harness.ts","evals/judge.ts","evals/cases/conflict-detection.ts"],"status":"active"}
{"id":"DEC-c8dd","created_at":"2026-01-02T02:43:26.323939Z","type":"product","problem":"FTS5 search has keyword mismatch issues - hyphens treated as NOT, no semantic understanding","choice":"Replace search command with raw SQL access via 'keel sql'","rationale":"Agents are LLMs - they can write SQL queries and filter results semantically. Aligns with DEC-2ace (agent IS the interface) and DEC-7543 (keel provides data, agent does operations)","decided_by":{"role":"agent"},"files":["cmd/keel/sql.go","internal/query/query.go"],"status":"active"}
{"id":"DEC-ac86","created_at":"2026-01-02T12:36:28.333376Z","type":"constraint","problem":"Decisions must never be lost or silently modified","choice":"Append-only ledger: decisions are never edited, only superseded","rationale":"Append-only ensures complete audit trail and prevents loss of context. When decisions change, we create new entries that explicitly supersede old ones, maintaining the full evolution of thinking rather than overwriting history.","decided_by":{"role":"human"},"files":["src/core/store.ts"],"status":"active","supersedes":"DEC-3957"}
{"id":"DEC-3957","created_at":"2025-12-22T16:30:23.871Z","type":"constraint","problem":"Decisions must never be lost or silently modified","choice":"Append-only ledger: decisions are never edited, only superseded","rationale":"Append-only preserves full history. Updates are recorded as new lines. Latest state derived at read time by merging entries with same ID.","decided_by":{"role":"human"},"files":["src/core/store.ts"],"status":"superseded","superseded_by":"DEC-ac86"}
{"id":"DEC-c42e","created_at":"2026-01-02T20:02:07.471857Z","type":"product","problem":"How to handle discovery at scale when active decisions grow to 100s or 1000s","choice":"Curate and summarize rather than add tagging infrastructure. Semantic search is a future option if needed.","rationale":"Agent-powered discovery (DEC-2ace) works if active count stays bounded. Curate workflow consolidates old decisions into summaries. Tags add complexity and shift work to humans. Semantic/vector search can be added later if curation isn't enough.","decided_by":{"role":"agent"},"status":"active"}
